# HTTP â†’ HTTPS redirect
server {
    listen 80;
    server_name myrealvaluation.com;
    return 301 https://$host$request_uri;
}

# TLS termination + reverse-proxy
server {
    listen 443 ssl;
    server_name myrealvaluation.com;

    ssl_certificate     /etc/letsencrypt/live/myrealvaluation.com/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/myrealvaluation.com/privkey.pem;

    # Start page at root
    location = /          { proxy_pass http://startpage:80/; proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; }

    # Booking site under dynamic paths and /s/
    location /s/         { proxy_pass http://site:80/;       proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; }
    location /           { proxy_pass http://site:80;        proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; }

    # Individual apps
    location /survey     { proxy_pass http://survey:80;      proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; }
    location /survey/    { proxy_pass http://survey:80/;     proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; }
    location /onboarding { proxy_pass http://onboarding:80;  proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; }
    location /onboarding/ { proxy_pass http://onboarding:80/; proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; }
    location /console/reports { proxy_pass http://leadreports:80/; proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; }
    location /console/reports/ { proxy_pass http://leadreports:80/; proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; }

    # Backend API
    location /api/      { proxy_pass http://api:3000/;      proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; }
}

